<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Exams Assistant</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
		<link rel="stylesheet" href="chatbot.css">
	</head>
	<body>
		<div id="container">
			<div id="res" class="background"></div>
			<div id="inptDiv">
				<input type="text" id="input" class="assets background">
				<button id="btn" class="assets background">Send</button>
			</div>
		</div>
		<script>
	    var res = document.getElementById("res");
	    var btn = document.getElementById("btn");
	
	    async function chatbotResponse() {
	        var inputValue = document.getElementById("input").value.trim().toLowerCase();
	        var dbUrl = 'answers.json';
	        if (inputValue === "") {
	            alert("Invalid input");
	            return;
	        }
	        try {
	            let response = await fetch(dbUrl);
	            if (!response.ok) {
	                throw new Error("Invalid JSON");
	            }
	            let data = await response.json();
	
	            let answer = "";
	
	            if (data) {
	                // Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï„Î¿ input ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Î±Ï€ÏŒ Ï„Î± greetings
	                if (data.greetings.includes(inputValue)) {
	                    answer = data.responses.greetings;
	                }
	                // Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï„Î¿ input ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Î±Ï€ÏŒ Ï„Î± bye
	                else if (inputValue.includes(data.bye)) {
	                    answer = data.responses.bye;
	                }
			// Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï„Î¿ input ÎµÎ¯Î½Î±Î¹ Î¾ÎµÎºÎ¹Î½Î¬ÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ wheather
	                else if (inputValue.includes(data.weather)) {
				for(var i=0;i<data.poleis.length;i++){
					if (inputValue.includes(data.poleis[i])){
		                    		polh=data.poleis[i];
						console.log(polh);
						break;
					}
				}
				 answer = await getWeather(polh);
	                }
	                // Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï„Î¿ input ÎµÎ¯Î½Î±Î¹ Î³Î¹Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ
	                else if (inputValue.includes(data.questions)) {
	                    let calculation = inputValue.replace(data.questions, "").trim();
	                    try {
	                        answer = data.responses.math + " " + eval(calculation);
	                    } catch (e) {
	                        answer = data.responses.mathfallback;
	                    }
	                }
	                // Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î±ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÏŒ Ï„ÎµÎ»ÎµÏƒÏ„Î® +, -, *, /, %
	                else {
	                    for (let i = 0; i < data.operators.length; i++) {
	                        if (inputValue.includes(data.operators[i])) {
	                            try {
	                                answer = data.responses.math + " " + eval(inputValue);
	                            } catch (e) {
	                                answer = data.responses.mathfallback;
	                            }
	                            break;
	                        }
	                    }
	                }
	            }
		
	            // Î‘Î½ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·, ÎºÎ¬Î½Îµ online Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
	            if (!answer) {
	                answer = await searchOnline(inputValue);
	            }
	
	            // Î ÏÎ¿Î²Î¿Î»Î® Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚
	            showMessage(inputValue, answer);
	        } catch (error) {
	            console.error("Error fetching data:", error);
	            showMessage(inputValue, "âš ï¸ Error processing your request.");
	        }
	    }
	
	    function searchOnline(query) {
	    const searchUrl = "https://api.duckduckgo.com/?q=" + encodeURIComponent(query) + "&format=json";
	
	    return fetch(searchUrl)
	        .then(response => response.json())
	        .then(data => {
	            if (!data.AbstractText) {
	                return "âš ï¸ No online results found.";
	            }
	
	            return "ğŸ” **Online Search Results:**<br>"+data.AbstractText+" <br><a href='"+data.AbstractURL+"' target='_blank'>More Info</a>";
	        })
	        .catch(error => {
	            console.error("âŒ Search error:", error);
	            return "âš ï¸ Online search failed.";
	        });
	   }


	    function showMessage(userInput, botResponse) {
	        var userMsg = document.createElement("p");
	        var botMsg = document.createElement("p");
	        var msgDiv = document.createElement("div");
	        msgDiv.classList.add("msgDiv");
	
	        userMsg.innerHTML = userInput;
	        userMsg.classList.add("usrMsg");
	        msgDiv.appendChild(userMsg);
	
	        botMsg.innerHTML = botResponse;
	        botMsg.classList.add("botMsg");
	        msgDiv.appendChild(botMsg);
	
	        res.appendChild(msgDiv);
	        document.getElementById("input").value = ""; // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ input
	    }
	   async function getWeather(city){
		    try {
		   	var res=await fetch("https://wttr.in/"+city+"?format=j1");
			let data = await response.json();
		        let weather = data.current_condition[0];
			return "ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ Î¸Î± ÎµÎ¯Î½Î±Î¹:"+weather.weatherDesc[0].value+weather.temp_C+"Â°C";
	            } catch {
	                return "âš ï¸ Î ÏÏŒÎ²Î»Î·Î¼Î± Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· ÎºÎ±Î¹ÏÎ¿Ï.";
	            }
	}
	    btn.addEventListener("click", chatbotResponse);
	    // Î†ÎºÎ¿Ï… Î³Î¹Î± Ï„Î¿ Î³ÎµÎ³Î¿Î½ÏŒÏ‚ 'enter' ÏƒÏ„Î¿ Ï€ÎµÎ´Î¯Î¿ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚
		var input=document.getElementById("input");
		input.addEventListener('keypress', function(event) {
			// Î‘Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€Î±Ï„Î®ÏƒÎµÎ¹ Ï„Î¿ Ï€Î»Î®ÎºÏ„ÏÎ¿ Enter (ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ 13)
			if (event.keyCode === 13) {
				event.preventDefault(); // Î‘Ï€Î¿Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Ï„Î¿Ï… Enter (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ submit Ï„Î·Ï‚ Ï†ÏŒÏÎ¼Î±Ï‚)
				btn.click(); // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î¿ click Ï„Î¿Ï… ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï, ÏƒÎ±Î½ Î½Î± Ï„Î¿ Ï€Î¬Ï„Î·ÏƒÎµ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚
			}
		});
		</script>
	</body>
</html>
